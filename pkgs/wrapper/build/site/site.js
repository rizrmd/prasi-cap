import{a as N,b as f,c as k,d as C,g as w,j as b,k as R,l as v,n as s}from"./chunk-G2XPISRL.js";var L=N(d=>{"use strict";var h=C();d.createRoot=h.createRoot,d.hydrateRoot=h.hydrateRoot;var G});var O=f(k()),j=f(L());var P=`/_web/${window.id_site}`,r={site:null,pages:[],api:null},T={async site(o,n){let e=await m("/site?prod=1");return r.site=e.site,r.pages=e.pages,r.api=e.api,s.serverurl=e.site.config.api_url,s.apiurl=e.site.config.api_url,s.prasiApi={[e.site.config.api_url]:{apiEntry:e.api}},e.site},async comp(o,n){let e=await m(`/comp/${n}`);return o.comps.all[n]=e,e},npm(o,n,e){return n==="site"?`/_web/${r.site.id}/npm-site/site.js`:`/_web/${r.site.id}/npm-page/${e}/page.js`},async page(o,n){let e=r.pages.find(t=>t.id===n);return e&&!e.content_tree?await m(`/page/${n}`):null},async pages(o,n){return r.pages}},m=async o=>{let e=await(await fetch(`${P}${o}`)).text();return JSON.parse(e)};var E=()=>{let o={send:()=>{},bind:t=>{},notif:{register:t=>{},send:async t=>{let i=e();if(i)return await i.script.api._notif("send",{type:"send",id:typeof t.user_id=="string"?t.user_id:t.user_id.toString(),body:t.body,title:t.title,data:t.data})},onTap:t=>{},onReceive:t=>{}}},n={notif_token:"",p:null},e=()=>{let t=n.p;if(t&&t.site&&t.site.api_url){let i=s.prasiApi[t.site.api_url];if(i&&i.apiEntry&&i.apiEntry._notif&&t.script&&t.script.api)return t}};if(window.parent){window.addEventListener("message",async({data:i})=>{if(typeof i=="object"&&i.mobile){console.log("capacitor",i);let a=i,g=async I=>{if(!t.notif.onTap){let y=null,_=0;await new Promise(()=>{y=setInterval(()=>{_++,_>20&&clearInterval(y),I()&&clearInterval(y)},500)});return}};switch(a.type){case"notification-token":n.notif_token=a.token;break;case"notification-tap":if(!t.notif.onTap){g(()=>t.notif.onTap?(t.notif.onTap(a.notif),!0):!1);return}t.notif.onTap&&t.notif.onTap(a.notif);break;case"notification-receive":t.notif.onReceive||g(()=>t.notif.onReceive?(t.notif.onReceive(a.notif),!0):!1),t.notif.onReceive&&t.notif.onReceive(a.notif);break}}});let t={send:i=>{window.parent.postMessage({mobile:!0,...i},"*")},bind(i){n.p=i},config:n,notif:{register:async i=>{let a=e();if(a)return await a.script.api._notif("register",{type:"register",id:typeof i=="string"?i:i.toString(),token:n.notif_token})},send:async i=>{let a=e();if(a)return await a.script.api._notif("send",{type:"send",id:typeof i.user_id=="string"?i.user_id:i.user_id.toString(),body:i.body,title:i.title,data:i.data})},onTap:null,onReceive:null}};return t}return{...o}};var p={site:null,pages:[],api:null,npm_pages:[]},x={async site(o,n){let e=await l("/content/site/site.json");p.site=e;let t=await l("/content/site/pages.json");p.pages=t;let i=await l("/content/site/npm_pages.json");return p.npm_pages=i,s.serverurl=e.config.api_url,s.apiurl=e.config.api_url,s.prasiApi={[e.config.api_url]:{apiEntry:e.api}},e},async comp(o,n){let e=await l(`/content/comps/${n}.json`);return o.comps.all[n]=e,e},npm(o,n,e){return n==="site"?"/content/npm/site/index.js":p.npm_pages.includes(e)?`/content/npm/pages/${e}/index.js`:""},async page(o,n){let e=p.pages.find(t=>t.id===n);if(console.log(e),e&&!e.content_tree){let t=await l(`/content/pages/${n}.json`);return console.log(t),t}return null},async pages(o,n){return p.pages}},l=async o=>{let e=await(await fetch(`${s.mobilepath}${o}`)).text();return JSON.parse(e)};var u=f(b()),c=window;c.mobile||(c.mobile=E());c.prasiContext={global:{},render(){}};var $=({url:o,Live:n})=>{let[e,t]=(0,O.useState)({});c.prasiContext.render=()=>{t({})};let i=w.Provider;return(0,u.jsx)(i,{value:c.prasiContext,children:(0,u.jsx)(n,{domain:o.host,pathname:location.pathname,loader:c.mobilepath?x:T})})};(async()=>{let o=document.getElementById("root");if(o){let n=(0,j.createRoot)(o),e=new URL(location.href);await v(!1),R();let{Live:t}=await import("./live-WF76DSIF.js");n.render((0,u.jsx)($,{url:e,Live:t})),document.body.classList.contains("opacity-0")&&document.body.classList.remove("opacity-0")}})();
//# sourceMappingURL=site.js.map
