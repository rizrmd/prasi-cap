import{a as O,b as c,c as k,d as C,g as _,j as g,k as R,l as b,n as s}from"./chunk-FN3KLWUZ.js";var v=O(u=>{"use strict";var w=C();u.createRoot=w.createRoot,u.hydrateRoot=w.hydrateRoot;var G});var h=c(k()),L=c(v());var N=`/_web/${window.id_site}`,a={site:null,pages:[],api:null},T={async site(o,i){let n=await y("/site?prod=1");return a.site=n.site,a.pages=n.pages,a.api=n.api,s.serverurl=n.site.config.api_url,s.apiurl=n.site.config.api_url,s.prasiApi={[n.site.config.api_url]:{apiEntry:n.api}},n.site},async comp(o,i){let n=await y(`/comp/${i}`);return o.comps.all[i]=n,n},npm(o,i,n){return i==="site"?`/_web/${a.site.id}/npm-site/site.js`:`/_web/${a.site.id}/npm-page/${n}/page.js`},async page(o,i){let n=a.pages.find(t=>t.id===i);return n&&!n.content_tree?await y(`/page/${i}`):null},async pages(o,i){return a.pages}},y=async o=>{let n=await(await fetch(`${N}${o}`)).text();return JSON.parse(n)};var E=()=>{let o={send:()=>{},bind:t=>{},notif:{register:t=>{},send:async t=>{let e=n();if(e)return await e.script.api._notif("send",{type:"send",id:typeof t.user_id=="string"?t.user_id:t.user_id.toString(),body:t.body,title:t.title,data:t.data})},onTap:t=>{},onReceive:t=>{}}},i={notif_token:"",p:null},n=()=>{let t=i.p;if(t&&t.site&&t.site.api_url){let e=s.prasiApi[t.site.api_url];if(e&&e.apiEntry&&e.apiEntry._notif&&t.script&&t.script.api)return t}};if(window.parent){window.addEventListener("message",async({data:e})=>{if(typeof e=="object"&&e.mobile){console.log("capacitor",e);let r=e,d=async I=>{if(!t.notif.onTap){let l=null,m=0;await new Promise(()=>{l=setInterval(()=>{m++,m>20&&clearInterval(l),I()&&clearInterval(l)},500)});return}};switch(r.type){case"notification-token":i.notif_token=r.token;break;case"notification-tap":if(!t.notif.onTap){d(()=>t.notif.onTap?(t.notif.onTap(r.notif),!0):!1);return}t.notif.onTap&&t.notif.onTap(r.notif);break;case"notification-receive":t.notif.onReceive||d(()=>t.notif.onReceive?(t.notif.onReceive(r.notif),!0):!1),t.notif.onReceive&&t.notif.onReceive(r.notif);break}}});let t={send:e=>{window.parent.postMessage({mobile:!0,...e},"*")},bind(e){i.p=e},config:i,notif:{register:async e=>{let r=n();if(r)return await r.script.api._notif("register",{type:"register",id:typeof e=="string"?e:e.toString(),token:i.notif_token})},send:async e=>{let r=n();if(r)return await r.script.api._notif("send",{type:"send",id:typeof e.user_id=="string"?e.user_id:e.user_id.toString(),body:e.body,title:e.title,data:e.data})},onTap:null,onReceive:null}};return t}return{...o}};var f=c(g()),p=window;p.mobile||(p.mobile=E());p.prasiContext={global:{},render(){}};var P=({url:o,Live:i})=>{let[n,t]=(0,h.useState)({});p.prasiContext.render=()=>{t({})};let e=_.Provider;return(0,f.jsx)(e,{value:p.prasiContext,children:(0,f.jsx)(i,{domain:o.host,pathname:location.pathname,loader:T})})};(async()=>{let o=document.getElementById("root");if(o){let i=(0,L.createRoot)(o),n=new URL(location.href);await b(!1),R();let{Live:t}=await import("./live-MURASLJZ.js");i.render((0,f.jsx)(P,{url:n,Live:t})),document.body.classList.contains("opacity-0")&&document.body.classList.remove("opacity-0")}})();
//# sourceMappingURL=site.js.map
