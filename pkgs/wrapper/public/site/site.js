import{a as k,b as c,c as C,d as N,g as _,j as g,k as b,l as R,n as r}from"./chunk-JLHOBHZF.js";var v=k(d=>{"use strict";var w=N();d.createRoot=w.createRoot,d.hydrateRoot=w.hydrateRoot;var G});var L=c(C()),I=c(v());var T=`/_web/${window.id_site}`,s={site:null,pages:[],api:null},h={async site(o,i){let n=await u("/site?prod=1");return s.site=n.site,s.pages=n.pages,s.api=n.api,typeof r.basepath>"u"&&(r.basepath=""),r.serverurl=n.site.config.api_url,r.apiurl=n.site.config.api_url,r.prasiApi={[n.site.config.api_url]:{apiEntry:n.api}},n.site},async comp(o,i){let n=await u(`/comp/${i}`);return o.comps.all[i]=n,n},npm(o,i,n){return i==="site"?`/_web/${s.site.id}/npm-site/site.js`:`/_web/${s.site.id}/npm-page/${n}/page.js`},async page(o,i){let n=s.pages.find(t=>t.id===i);return n&&!n.content_tree?await u(`/page/${i}`):null},async pages(o,i){return s.pages}},u=async o=>{console.log("loading",`${r.basepath}${T}${o}`);let n=await(await fetch(`${r.basepath}${T}${o}`)).text();return JSON.parse(n)};var E=()=>{let o={send:()=>{},bind:t=>{},notif:{register:t=>{},send:async t=>{let e=n();if(e)return await e.script.api._notif("send",{type:"send",id:typeof t.user_id=="string"?t.user_id:t.user_id.toString(),body:t.body,title:t.title,data:t.data})},onTap:t=>{},onReceive:t=>{}}},i={notif_token:"",p:null},n=()=>{let t=i.p;if(t&&t.site&&t.site.api_url){let e=r.prasiApi[t.site.api_url];if(e&&e.apiEntry&&e.apiEntry._notif&&t.script&&t.script.api)return t}};if(window.parent){window.addEventListener("message",async({data:e})=>{if(typeof e=="object"&&e.mobile){console.log("capacitor",e);let a=e,y=async O=>{if(!t.notif.onTap){let l=null,m=0;await new Promise(()=>{l=setInterval(()=>{m++,m>20&&clearInterval(l),O()&&clearInterval(l)},500)});return}};switch(a.type){case"notification-token":i.notif_token=a.token;break;case"notification-tap":if(!t.notif.onTap){y(()=>t.notif.onTap?(t.notif.onTap(a.notif),!0):!1);return}t.notif.onTap&&t.notif.onTap(a.notif);break;case"notification-receive":t.notif.onReceive||y(()=>t.notif.onReceive?(t.notif.onReceive(a.notif),!0):!1),t.notif.onReceive&&t.notif.onReceive(a.notif);break}}});let t={send:e=>{window.parent.postMessage({mobile:!0,...e},"*")},bind(e){i.p=e},config:i,notif:{register:async e=>{let a=n();if(a)return await a.script.api._notif("register",{type:"register",id:typeof e=="string"?e:e.toString(),token:i.notif_token})},send:async e=>{let a=n();if(a)return await a.script.api._notif("send",{type:"send",id:typeof e.user_id=="string"?e.user_id:e.user_id.toString(),body:e.body,title:e.title,data:e.data})},onTap:null,onReceive:null}};return t}return{...o}};var f=c(g()),p=window;p.mobile||(p.mobile=E());p.prasiContext={global:{},render(){}};var P=({url:o,Live:i})=>{let[n,t]=(0,L.useState)({});p.prasiContext.render=()=>{t({})};let e=_.Provider;return(0,f.jsx)(e,{value:p.prasiContext,children:(0,f.jsx)(i,{domain:o.host,pathname:location.pathname,loader:h})})};(async()=>{let o=document.getElementById("root");if(o){let i=(0,I.createRoot)(o),n=new URL(location.href);await R(!1),b();let{Live:t}=await import("./live-XFSG7ZBN.js");i.render((0,f.jsx)(P,{url:n,Live:t})),document.body.classList.contains("opacity-0")&&document.body.classList.remove("opacity-0")}})();
//# sourceMappingURL=site.js.map
